################################################################################
# SafeNest Mosquitto MQTT Broker Configuration
#
# This configuration enables local non-TLS connections for dashboard and webhook
# All connections on localhost only (no external access)
#
# Location: /etc/mosquitto/mosquitto.conf (copy this file there)
################################################################################

# === GENERAL SETTINGS ===
# Persistence location for retained messages and subscriptions
persistence true
persistence_location /var/lib/mosquitto/

# Log destinations
log_dest file /var/log/mosquitto/mosquitto.log
log_dest stdout

# Log types - enable all for security monitoring
log_type error
log_type warning
log_type notice
log_type information
connection_messages true

# Log timestamps
log_timestamp true
log_timestamp_format %Y-%m-%d %H:%M:%S

# === LISTENER - NON-TLS FOR LOCAL CONNECTIONS ===
# Local listener on port 1883 (no TLS for localhost services)
listener 1883
protocol mqtt

# === AUTHENTICATION ===
# Require username and password
allow_anonymous false
password_file /etc/mosquitto/passwd

# === ACCESS CONTROL ===
# Enable ACL (Access Control List) for topic-based permissions
acl_file /etc/mosquitto/aclfile.conf

# === RATE LIMITING (DOS PROTECTION) ===
# Maximum number of QoS 1 and 2 messages currently inflight per client
max_inflight_messages 20

# Maximum number of QoS 1 and 2 messages to hold in queue per client
max_queued_messages 100

# Maximum number of messages to hold in queue while client is disconnected (QoS > 0)
max_queued_bytes 1000000

# Maximum publish payload size (1MB)
message_size_limit 1048576

# === CONNECTION LIMITS ===
# Maximum simultaneous client connections (-1 = unlimited, set limit for DoS protection)
max_connections 100

# Client keepalive timeout
persistent_client_expiration 1h
